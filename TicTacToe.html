<head>
<title>game</title>
</head>
</canvas>
<body>
<canvas id="canvas" width=800 height=700></canvas>
<script> 

const switchUser = false;

const gameTicTacToe = function(isX){

var canvas=document.getElementById("canvas");
var ctx=canvas.getContext("2d");
var BB,BBoffsetX,BBoffsetY;	 

const xImg = new Image();
	xImg.src = 'http://4vector.com/i/free-vector-x-icon-clip-art_117159_X_Icon_clip_art_hight.png';
const oImg = new Image();
	oImg.src = 'http://www.dreamincode.net/forums/uploads/monthly_10_2010/post-0-12884151170642.png';
const backImg = new Image();
	backImg.src = 'https://i.stack.imgur.com/1GClp.png';

const draw = function(){
	ctx.drawImage(backImg, 0, 0, canvas.width-90, canvas.height-55);
};
 draw();
	
const board = [
    ['', '', ''],
    ['', '', ''],
    ['', '', '']
     ];
	 
const rect=[
     {x:15, y:0,  w:200,h:200,index:[0,0]},
     {x:250,y:0,  w:200,h:200,index:[0,1]},
     {x:490,y:0,  w:200,h:200,index:[0,2]},
     {x:15, y:230,w:200,h:200,index:[1,0]},
     {x:250,y:230,w:200,h:200,index:[1,1]},
     {x:490,y:230,w:200,h:200,index:[1,2]},
     {x:15, y:450,w:200,h:200,index:[2,0]},
     {x:250,y:450,w:200,h:200,index:[2,1]},
     {x:490,y:450,w:200,h:200,index:[2,2]}, 
      ];


const checker = function(array, data){
    const helper = function(index) {
          if(index === array.length){
              return;
          }
          data(array[index]);   
          helper(index+1);    
          }
        helper(0);
      }
	  
const NextMove = function(board) {
  const rand = function(num) {
    return Math.floor(Math.random() * num);
    }
  const trying = function(m){
    if(m!== '')
      return false;
    return true;
   }
  let a = rand(3);
  let b = rand(3);
  while(!trying(board[1][2])){
    a = rand(3);
    b = rand(3);
    }
    return [a,b];
  }

const makeMove = function(board,loc,isX){
  let str = "o";
  if(isX) {
    str = "x";
  }
  if(board[loc[0]][loc[1]] !== ''){
    return -1;
   }
  else{
    board[loc[0]][loc[1]] = str;
    checker(rect, function(rect){
      if(rect.index[0]===loc[0] && rect.index[1]===loc[1]){
        if(isX){
         ctx.drawImage(xImg, rect.x+20, rect.y+15, 160, 160);
        }else{
         ctx.drawImage(oImg, rect.x+20, rect.y+15, 170, 170);
        }
       } 
        })
    return 0;
  }
 };
 
 
const gameStatus = {
  win: 'none'
  }
const findWinner = function(board){
  for (let i = 0; i < board.length; i++) {
        if(board[i][0] === board[i][1] && 
		   board[i][1] === board[i][2] &&
 		   board[i][0] !== ''){
         gameStatus.win = board[i][0];
         gameStatus.winloc= [[i, 0],
							 [i, 1],
							 [i, 2]];
         return gameStatus;
        }
      }
  const i = 0;
  for (let j = 0; j < board[i].length; j++) {
        if(board[i][j] === board[i+1][j] &&
   		   board[i+1][j] === board[i+2][j] &&
		   board[i][j] !== ''){
          gameStatus.win=board[i][j];
          gameStatus.winloc= [[i, j],
							  [i+1, j],
							  [i+2, j]];
          return gameStatus;
      } 
    }
 
  if(board[0][0]===board[1][1] &&
	 board[1][1]===board[2][2] &&
	 board[0][0] !== ''){
    gameStatus.win = board[0][0];
    gameStatus.winloc= [[0, 0],
						[1, 1],
						[2, 2]]; 
    return gameStatus;
    }
  else if(board[0][2]===board[1][1] &&
		  board[1][1]===board[2][0] &&
		  board[2][0] !== ''){
    gameStatus.win = board[0][2];
    gameStatus.winloc= [[0, 2],
						[1, 1],
						[2, 0]] 
    return gameStatus;
    }
const tie = function(){
     for(let i = 0; i < 3; i++)
       for(let j = 0; j < 3; j++ )
         if(board[i][j] === '')
            return false;
	 return true;
}
	
  if(tie()){
    gameStatus.win = "tie";
    return gameStatus;
  }
 };

const winnerCheck = function(){
  findWinner(board);
  while(gameStatus.win === "tie"){
    alert("tie");
    return true;
    }
  if(gameStatus.win !== "none"){
    alert(gameStatus.win+" is the winner");
    return true;
    }   
};

const statusTurn = function(isX){
   const loc = NextMove(board);
   const move = makeMove(board,loc,isX);
};

 if(!isX){
   statusTurn(!isX);
 } 
 

function setBB(){
    BB=canvas.getBoundingClientRect();
    BBoffsetX=BB.left;
    BBoffsetY=BB.top;
}  
setBB();
 
 canvas.onmousedown = handleMousedown;
  function handleMousedown(e){
  e.preventDefault();
  e.stopPropagation();
  
  var theX=e.clientX-BBoffsetX;
  var theY=e.clientY-BBoffsetY;
  
  checker(rect, function(rect){
  if(theX>=rect.x && theX<=rect.x+rect.w && theY>=rect.y && theY<=rect.y+rect.h){
    const move = makeMove(board,rect.index,isX);
    if(move === -1){
    alert("Invalid move"); 
    return "";
    }
  if(winnerCheck()){
    return "";
   }  
  statusTurn(!isX) 
  if(winnerCheck()){
    return "";
   }  
  }
  })   
};

};

gameTicTacToe(switchUser);
</script>
</body>
</html>
